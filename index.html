<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link rel="icon" 
      type="image/x-icon" 
      href="favicon.ico">
    <script
      src="https://kit.fontawesome.com/ea2379d57d.js"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    />
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css?family=PT+Sans:700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Noto+Sans&display=swap"
      rel="stylesheet"
    />
    <title>Earth Automation</title>
    <style>
      body {
        margin: 0;
        font-size: 14px;
        background-color: #e6e6e6;
        font-family: "Noto Sans";
      }

      /*
        Summary
      */

      .row {
        background-color: #fff !important;
        margin: 15px;
      }

      #home h4 {
        font-family: "PT Sans";
        padding-top: 15px;
      }

      #home .list-group-item {
        display: inline-block;
        padding: 15px;
        padding-top: 0px;
        background-color: #f5f5f5;
        width: 220px;
        text-align: center;
        cursor: pointer;
        margin-right: 10px;
        border: 1px solid rgba(0, 0, 0, 0.125) !important;
        max-height: 100px;
        margin-top: 20px;
      }

      #home .list-group-item:first-child {
        border-top-left-radius: 0px;
        border-top-right-radius: 0px;
      }

      #home .list-group-item:last-child {
        border-bottom-right-radius: 0px;
        border-bottom-left-radius: 0px;
      }

      .summary-val {
        font-family: "PT Sans";
        font-size: 3.2em;
        display: inline-block;
      }

      .summary-unit {
        font-family: "PT Sans";
        font-size: 1.6em;
        display: inline-block;
      }

      .summary-desc {
        line-height: 0.6em;
      }

        .summary-group {
          display: flex;
        }

      @media (max-width: 500px) {
        #home .list-group-item {
          display: block;
          width: 100%;
        }

        .summary-group {
          text-align: center;
        }

        .control-container {
          display: none;
        }
      }

      .slide-container {
        height: 50px;
      }

      .calendar-icon {
        margin-right: 10px;
      }

      .date-selection-label {
        font-family: "PT Sans";
        font-size: 1.4em;
        line-height: 1.6em;
      }

      .tick line {
        display: none;
      }

      .tick text {
        font-family: "PT Sans";
        opacity: 0.6;
      }
      a:hover,
      a {
        color: black;
      }

      /*
        Charts
      */
      .chart-0 {
        width: 100%;
        height: 320px;
        background-color: #fff;
      }

      .chart-1 {
        width: 100%;
        height: 320px;
        background-color: #fff;
      }

      .chart-2 {
        width: 100%;
        height: 320px;
        background-color: #fff;
      }

      .chart-3 {
        width: 100%;
        height: 320px;
        background-color: #fff;
      }

      .chart-4 {
        width: 100%;
        height: 320px;
        background-color: #fff;
      }

      .chart-title {
        font-family: "PT Sans";
        font-size: 1.4em;
      }

      .legend-label {
        font-size: 0.8em;
        opacity: 0.6;
      }

      .weight-line {
        fill: none;
        stroke: #1c5630;
        stroke-width: 2.5px;
      }

      .weight-circle {
        fill: #1c5630;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .waste-bar {
        fill: #73b431;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .carbon-bar {
        fill: #ff8000;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .co2-line {
        fill: none;
        stroke: #1c5630;
        stroke-width: 2.5px;
      }

      .co2-circle {
        fill: #1c5630;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .compost-bar {
        fill: #73b431;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .airspace-area {
        fill: #2274a5;
        cursor: pointer;
      }

      .airspace-circle {
        fill: #2274a5;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .temp-bar {
        fill: #ff8000;
        stroke: black;
        stroke-width: 0px;
        cursor: pointer;
      }

      .temp-ave-line {
        fill: none;
        stroke: #525252;
        stroke-width: 2px;
        opacity: 0.5
      }

      .temp-line {
        fill: none;
        stroke: #D6D6D6;
        stroke-width: 2px;
      }
      /*
       Chart Controls
      */

      .logout-container-0 {
        position: absolute;
        top: 120px;
        right: 40px;
        color: #858585;
      }

      .control-container {
        position: absolute;
        top: 330px;
        right: 40px;
        color: #858585;
      }

      .column-control-container {
        position: relative;
        top: -10px;
        left: 10px;
      }

      .compress-expand-container {
        display: inline-block;
        padding: 5px;
      }

      .logout-container {
        display: inline-block;
        padding: 10px;
        text-decoration: underline;
        font-family: "PT Sans";
        border: 1px solid #D6D6D6;
      }

      .download-data-container {
        display: inline-block;
        padding: 10px;
        text-decoration: underline;
        font-family: "PT Sans";
        border: 1px solid #D6D6D6;
      }

      .chart-0 .control-container {
        right: 10px;
        top: 10px;
      }

      .chart-1 .control-container {
        right: 10px;
        top: 10px;
      }

      .chart-2 .control-container {
        right: 10px;
        top: 10px;
      }

      .chart-3 .control-container {
        right: 10px;
        top: 10px;
      }

      .chart-4 .control-container {
        right: 10px;
        top: 10px;
      }
      /*
        Tooltip
      */
      .general-tooltip {
        position: fixed;
        max-width: 200px;
        background-color: #fff;
        display: none;
        border: 1px solid;
        opacity: 0.9;
        padding: 10px;
      }

      .chart-tooltip {
        position: fixed;
        width: 200px;
        background-color: #fff;
        display: none;
        border: 1px solid;
        opacity: 0.9;
        padding: 10px;
      }

      .tooltip-label {
        display: inline-block;
      }

      .tooltip-value {
        display: inline-block;
        font-family: "PT Sans";
        float: right;
      }

      .logo-container {
        display: inline-block;
        flex-grow: 100;
        text-align: center;
        float: right;
        margin-right: -10px;
      }

      .logo {
        width: 100px;
        cursor: pointer;
        
      }

      .site-logo-container {
        width: 200px;
        display: inline-block;
      }

      .site-logo {
        width: 200px;
      }

      .footer {
        background-color: #e6e6e6;
        height: 140px;
      }

      .footer .row {
        position: relative;
        top: 40px;
        background-color: #e6e6e6 !important;
        font-family: "Noto Sans";
        color: #858585;
      }

      .individual-badge {
        list-style-type: none;
        display: inline-block;
        width: 40px;
        text-align: center;
        background-color: #73b431;
        color: white !important;
        padding: 10px;
        border-radius: 10px;
        cursor: pointer;
        margin-left: 5px;
      }

      .social-icon-link {
        color: white !important;
      }

      .individual-badge:hover {
        background-color: #ff8000;
      }

      .social-badges-container {
            text-align: center;
      }

      .footer-email {
        float: right;
      }

      .footer-number {
        margin-top: 0px;
        margin-bottom: 0px;
      }


    </style>
    <script src="https://d3js.org/d3.v5.min.js"></script>
  </head>
  <body>
    <div class="charts" id="home">
      <div class="container-fluid">
        <div class="row header">
          <div class="col-sm-12">
            <div class="site-logo-container">
              <img class="site-logo" src="assets/discovery.png" alt="Discovery Logo">
            </div>
            <a class="logo-container" href="https://www.earthprobiotic.co.za/" target="_blank">
              <img class="logo" src="assets/earthprobiotic.png" alt="Earth_Probiotic_logo">
            </a>
            <h4 class="">
                Discovery Site XYZ
            </h4>
          </div>
          <div class="col-sm-12">
            <div class="summary-group">
              <a class="list-group-item" href="#waste">
                <div class="summary-val waste-val"></div>
                <div class="summary-unit">kg</div>
                <div class="summary-desc">Total Waste Diverted</div>
              </a>
              <a class="list-group-item" href="#co2">
                <div class="summary-val co2-val"></div>
                <div class="summary-unit">kg</div>
                <div class="summary-desc">Total CO²e Saved</div>
              </a>
              <a class="list-group-item" href="#airspace">
                <div class="summary-val airspace-val"></div>
                <div class="summary-unit">m<sup>2</sup></div>
                <div class="summary-desc">Total Airspace Saved</div>
              </a>
              <a class="list-group-item" href="#compost">
                <div class="summary-val compost-val"></div>
                <div class="summary-unit">kg</div>
                <div class="summary-desc">Total Compost Output</div>
              </a>
            </div>
            <h4 class="date-selection-label">
              <i class="far fa-calendar-alt calendar-icon"></i> -
            </h4>
            <div class="slide-container"></div>
          </div>
        </div>
        <div class="row row-0">
          <div class="col-sm-12">
            <div class="chart chart-0" id="waste"></div>
          </div>
        </div>
        <div class="row row-1">
          <div class="col-sm-12">
            <div class="chart chart-1" id="co2"></div>
          </div>
        </div>
        <div class="row row-2">
          <div class="col-sm-12">
            <div class="chart chart-2" id="compost"></div>
          </div>
        </div>
        <div class="row row-3">
          <div class="col-sm-12">
            <div class="chart chart-3" id="airspace"></div>
          </div>
        </div>
        <div class="row row-4">
          <div class="col-sm-12">
            <div class="chart chart-4" id="temperature"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="container-fluid">
        <div class="row">
          <div class="col-sm-4">
          <a class="footer-number" href="tel:0765813087" class="contact-link">Tel: +27 76 581 3087</a>
          <a class="footer-number" href="tel:0720898386" class="contact-link">or +27 72 089 8386</a>
          </div>
          <div class="col-sm-4">
            <ul class="social-badges-container">
              <li class="individual-badge">
                <a    class="social-icon-link"
                      href="https://www.twitter.com/earthprobiotic"
                      target="_blank">
                  <i class="fab fa-twitter fa-lg"></i>
                </a>
              </li>
              <li class="individual-badge">
                <a    class="social-icon-link"
                      href="https://www.facebook.com/earthprobiotic"
                      target="_blank">
                  <i class="fab fa-facebook-f fa-lg"></i>
                </a>
              </li>
              <li class="individual-badge">
                <a    class="social-icon-link"
                      href="https://za.pinterest.com/earthprobiotic/"
                      target="_blank">
                  <i class="fab fa-pinterest-p fa-lg"></i>
                </a>
              </li>
              <li class="individual-badge">
                <a    class="social-icon-link"
                      href="https://www.youtube.com/earthprobiotic"
                      target="_blank">
                <i class="fab fa-youtube fa-lg"></i>
                </a>
              </lo>
            </ul>
          </div>
          <div class="col-sm-4 ">
          <a class="footer-email" href="mailto:info@earthprobiotic.com" class="contact-link">info@earthprobiotic.com</a>
          </div>
        </div>
      </div>
      
    </div>

    <div class="general-tooltip">
      <div class="general-tooltip-content"></div>
    </div>
    <div class="chart-tooltip">
      <div class="chart-tooltip-content"></div>
    </div>

    <script>
      // define variables
      const numGraphs = 5;
      const legend_size = 12;
      const hide_duration = 1000;
      var is_resize = 1;
      var resizeTimer;
      var xScale_Chart_1,
        yScale_Chart_1,
        yScaleLeft,
        yScaleRight,
        yScale_Chart_2,
        yScale_Chart_3,
        yScale_Chart_4;
      const settings = {
        data_path: "https://storage.googleapis.com/earthautomation-6d365.appspot.com/Discovery.csv",
        logo_path: "assets/logo.png",
      };
      var chartDims = {
        "0": { width: "100vw", height: "320" },
        "1": { width: "100vw", height: "320" },
        "2": { width: "100vw", height: "320" },
        "3": { width: "100vw", height: "320" },
        "4": { width: "100vw", height: "320" },
      };

      const margin = {
        top: 70,
        bottom: 40,
        left: 40,
        right: 40,
      };
      let expandStatus = false;
      var dateVar;
      const formatDateObject = d3.timeFormat("%Y/%m/%d");
      /*d3.json("waste.json").then(function (waste) {
        d3.json("carbon.json").then(function (carbon) {
          d3.json("weight.json").then(function (weight) {
            d3.json("compost.json").then(function (compost) {
              d3.json("co2.json").then(function (co2) {
                d3.json("airspace.json").then(function (airspace) {
                  d3.json("temp.json").then(function (temp) {
                    data = {
                      waste: waste,
                      carbon: carbon,
                      weight: weight,
                      compost: compost,
                      co2: co2,
                      carbon: carbon,
                      airspace: airspace,
                      temp: temp,
                    };
                    myCode(data);
                  });
                });
              });
            });
          });
        });
      });*/
      d3.csv(settings.data_path).then(function(data) {
          myCode(data)
      })

      function formatDate(date) {
        let dated = date.split("/");
        return dated[0] + "-" + dated[1] + "-" + dated[2];
      }

      function myCode(data) {
        const minDate = d3.min(data, function (d) {
          return new Date((d.date).split("-")[0], (d.date).split("-")[1]-1, (d.date).split("-")[2])
        });

        const maxDate = d3.max(data, function (d) {
          return new Date((d.date).split("-")[0], (d.date).split("-")[1]-1, (d.date).split("-")[2])
        });

        var currentMinDate = minDate;
        var currentMaxDate = maxDate;
        
        render_graphs(1);

        window.addEventListener("resize", function () {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(function () {
            resize_charts();
          }, 200);
        });

        function resize_charts() {
          hideGeneralTooltip();
          remove_graphs();
          render_graphs();
          resize_header()
        }


        function render_graphs(animation=0) {
          days = d3.timeDay.range(
            currentMinDate,
            currentMaxDate.setDate(currentMaxDate.getDate())
          );

          var ticks = days.length;

          var maxTicks =
            (d3.select(".chart-0").style("width").slice(0, -2) -
              margin.right -
              margin.left) /
            60;

          if (ticks > 31 && ticks > maxTicks) {
            ticks = Math.round(maxTicks);
          } else {
            if (ticks > 15) {
              ticks = Math.round(ticks / 2);
            }
          }


          let newWasteData = [];
          let newCarbonData = [];
          let newWeightData = [];
          let carbonAndWaste = [];
          let newCompostData = [];
          let newCo2Data = [];
          let newAirspaceData = [];
          let newTempData = [];
          days.forEach(function (v) {
            var objWaste = { date: v, value: null };
            var objCarbon = { date: v, value: null };
            var objWeight = { date: v, value: null };
            var objCompost = { date: v, value: null };
            var objCo2 = { date: v, value: null };
            var objAirspace = { date: v, value: null };
            var objTemp = { date: v, maxValue: null, minValue: null, avgValue: null};
            data.forEach(function (w) {
              carbonAndWaste.push(+w.waste);
              carbonAndWaste.push(+w.carbon);
              var date = new Date(w.date.split("-")[0], w.date.split("-")[1]-1, w.date.split("-")[2])
              if ((date.getUTCDate() == v.getUTCDate()) && (date.getMonth() == v.getMonth()) && (date.getFullYear() == v.getFullYear())) {
                objWaste.value = +w.waste;
                objCarbon.value = +w.carbon;
                objWeight.value = +w.weight;
                objCompost.value = +w.compost;
                objCo2.value = +w.co2;
                objAirspace.value = +w.airspace;
                objTemp.maxValue = +w.max_temp;
                objTemp.minValue = +w.min_temp;
                objTemp.avgValue = +w.avg_temp;
              }
            });
            newWasteData.push(objWaste);
            newCarbonData.push(objCarbon);
            newWeightData.push(objWeight);
            newCompostData.push(objCompost);
            newCo2Data.push(objCo2);
            newAirspaceData.push(objAirspace);
            newTempData.push(objTemp);
          });

          var compostTracker = 0
          newCompostData.forEach(function(v) {
            compostTracker += v.value
            if (v.date.getDate() == 1) {
              v.new_value = compostTracker
              compostTracker = 0
            } else {
              v.new_value = 0
            }
          })

          /*
          Chart: 0

          Summary Statistics

          */
          var currentCarbonTotal = d3.sum(newCarbonData, function (d) {
            return d.value;
          });

          var currentWasteTotal = d3.sum(newWasteData, function (d) {
            return d.value;
          });

          var currenCo2Total = d3.sum(newCo2Data, function (d) {
            return d.value;
          });

          var currentAirspaceTotal = d3.sum(newAirspaceData, function (d) {
            return d.value;
          });

          var currentCompostTotal = d3.sum(newCompostData, function (d) {
            return d.value;
          });

          d3.select(".waste-val").text(format_value(currentWasteTotal + currentCarbonTotal));
          d3.select(".co2-val").text(format_value(currenCo2Total));
          d3.select(".airspace-val").text(format_value(currentAirspaceTotal));
          d3.select(".compost-val").text(format_value(currentCompostTotal));

          var logout_container_0 = d3
            .select(".header")
            .append("div")
            .attr("class", "logout-container-0");

          logout_container_0
            .append("div")
            .attr("class", "logout-container")
            /*.append("i")
            .attr("class", function () {
              return "fas fa-file-download fa-lg";
            })*/
            .html("<i class='fas fa-sign-out-alt fa-lg'></i>   Logout")
            .style("cursor", "pointer")
            .on("click", function () {
              // logout
            })
            .on("mouseover", function () {
              showGeneralTooltip("Logout from dashboard");
            })
            .on("mouseout", hideGeneralTooltip);

          var control_container_0 = d3
            .select(".header")
            .append("div")
            .attr("class", "control-container");

          control_container_0
            .append("div")
            .attr("class", "download-data-container")
            /*.append("i")
            .attr("class", function () {
              return "fas fa-file-download fa-lg";
            })*/
            .html("<i class='fas fa-file-download fa-lg'></i>   Download Data")
            .style("cursor", "pointer")
            .on("click", function () {
              window.location.href = settings.data_path
            })
            .on("mouseover", function () {
              showGeneralTooltip("Download data as CSV");
            })
            .on("mouseout", hideGeneralTooltip);

          /*
          Chart: 0

          Summary Waste, Weight & Carbon Graph

          */
          var chart_0 = d3
            .select(".chart-0")
            .append("svg")
            .attr("width", d3.select(".chart-0").style("width"))
            .attr("height", d3.select(".chart-0").style("height"));

          var chart_0_title_rect = chart_0
            .append("rect")
            .attr("class", "chart-title-rect")
            .attr("x", -5)
            .attr("y", 18)
            .attr("height", 34)
            .attr("fill", "#73B431");

          chart_0
            .append("text")
            .attr("class", "chart-title chart-0-title")
            .text("Waste Diverted")
            .attr("x", 10)
            .attr("y", 41)
            .attr("fill", "#fff");

          chart_0_title_rect.attr(
            "width",
            document
              .getElementsByClassName("chart-0-title")[0]
              .getBoundingClientRect().width + 33
          );

          var maxLeft = d3.max(carbonAndWaste);
          var maxRight = d3.max(newWeightData, function (d) {
            return d.value;
          });

          var xScale = d3
            .scaleTime()
            .domain([currentMinDate, currentMaxDate])
            .range([
              margin.left,
              d3.select(".chart-0").style("width").slice(0, -2) - margin.right,
            ]);

          yScaleLeft = d3
            .scaleLinear()
            .domain([0, maxLeft])
            .range([
              d3.select(".chart-0").style("height").slice(0, -2) -
                margin.bottom,
              margin.top,
            ])
            .nice();

          yScaleRight = d3
            .scaleLinear()
            .domain([0, maxRight])
            .range([
              d3.select(".chart-0").style("height").slice(0, -2) -
                margin.bottom,
              margin.top,
            ])
            .nice();

          line1_hide = d3
            .line()
            .x(function (d, i) {
              
              return xScale(new Date(d.date));
            })
            .y(function (d) {
              return yScaleRight(0);
            })
            .defined(function (d) {
              return d.value !== null;
            });

          line1 = d3
            .line()
            .x(function (d, i) {
              return xScale(new Date(d.date));
            })
            .y(function (d) {
              return yScaleRight(d.value);
            })
            .defined(function (d) {
              return d.value !== null;
            });

          chart_0
            .append("g")
            .attr("class", "y-axis")
            .call(d3.axisLeft(yScaleLeft))
            .attr("transform", "translate(" + margin.left + ",0)");

          chart_0
            .append("g")
            .attr("class", "y-axis")
            .call(d3.axisRight(yScaleRight))
            .attr(
              "transform",
              "translate(" +
                (d3.select(".chart-0").style("width").slice(0, -2) -
                  margin.right) +
                ",0)"
            );

          if (days.length > 180) {
            chart_0
              .append("g")
              .attr("class", "x-axis")
              .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat("%b")))
              .attr(
                "transform",
                "translate(0," +
                  (d3.select(".chart-0").style("height").slice(0, -2) -
                    margin.bottom) +
                  ")"
              );
          } else {
            chart_0
              .append("g")
              .attr("class", "x-axis")
              .call(
                d3
                  .axisBottom(xScale)
                  .tickFormat(d3.timeFormat("%m/%e"))
                  .tickArguments([ticks])
              )
              .attr(
                "transform",
                "translate(0," +
                  (d3.select(".chart-0").style("height").slice(0, -2) -
                    margin.bottom) +
                  ")"
              );
          }

          chart_0
            .selectAll(".waste-bar")
            .data(newWasteData)
            .enter()
            .append("rect")
            .attr("class", "bar waste-bar")
            .attr("x", function (d, i) {
              return xScale(new Date(d.date));
            })
            .attr("y", function (d) {
              return yScaleLeft(0);
            })
            .attr("width", function (d, i) {
              var next = d3.utcDay.offset(d.date, 1);

              return xScale(new Date(next)) - xScale(new Date(d.date));
            })
            .attr("height", function (d) {
              return 0
            })
            .on("mouseover", function (d) {
              graph_0_mouseover(d);
            })
            .on("mouseout", hideChartTooltip);

          chart_0
            .selectAll(".carbon-bar")
            .data(newCarbonData)
            .enter()
            .append("rect")
            .attr("class", "bar carbon-bar")
            .attr("x", function (d, i) {
              return xScale(new Date(d.date));
            })
            .attr("y", function (d) {
              return yScaleLeft(0);
            })
            .attr("width", function (d, i) {
              var next = d3.utcDay.offset(d.date, 1);
              return xScale(new Date(next)) - xScale(new Date(d.date));
            })
            .attr("height", function (d) {
              return 0
            })
            .on("mouseover", function (d) {
              graph_0_mouseover(d);
            })
            .on("mouseout", hideChartTooltip);

          chart_0
            .append("path")
            .datum(newWeightData)
            .attr("class", "line weight-line")
            .attr("d", line1_hide);

          var chart_0_legend = [
            { color: "#ff8000", label: "Carbon (kg)" },
            { color: "#73b431", label: "Food Waste (kg)" },
            { color: "#1c5630", label: "End of day Weight (kg)" },
          ];

          chart_0_legend.forEach(function (u, i) {
            chart_0
              .append("rect")
              .attr("width", legend_size)
              .attr("height", legend_size)
              .attr("fill", u.color)
              .attr("y", 37)
              .attr("x", i * 120 + 170);

            chart_0
              .append("text")
              .attr("class", "legend-label")
              .attr("y", 48)
              .attr("x", i * 120 + 190)
              .text(u.label);
          });

          chart_0
            .selectAll(".weight-circle")
            .data(newWeightData)
            .enter()
            .append("circle")
            .attr("class", "bar weight-circle")
            .attr("cx", function (d, i) {
              return xScale(new Date(d.date));
            })
            .attr("cy", function (d) {
              return yScaleRight(d.value);
            })
            .attr("r", 0)
            .on("mouseover", function (d) {
              graph_0_mouseover(d);
            })
            .on("mouseout", hideChartTooltip);

          var control_container_0 = d3
            .select(".chart-0")
            .append("div")
            .attr("class", "control-container");

          control_container_0
            .append("div")
            .attr("class", "compress-expand-container")
            .append("i")
            .attr("class", function () {
              if (expandStatus) {
                return "fas fa-compress-arrows-alt fa-lg";
              } else {
                return "fas fa-expand-arrows-alt fa-lg";
              }
            })
            .style("cursor", "pointer")
            .on("click", function () {
              if (expandStatus) {
                contract_chart();
              } else {
                expand_chart(0);
              }
            })
            .on("mouseover", function () {
              if (expandStatus) {
                showGeneralTooltip("Contract Chart");
              } else {
                showGeneralTooltip("Expand Chart");
              }
            })
            .on("mouseout", hideGeneralTooltip);

          // transition in
          chart_0.selectAll(".weight-line")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration
              } else {
                return 0
              }
            })
            .attr("d", line1);

          chart_0.selectAll(".waste-bar")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration
              } else {
                return 0
              }
            })
            .attr("y", function (d) {
              return yScaleLeft(d.value);
            })
            .attr("height", function (d) {
              return yScaleLeft(0) - yScaleLeft(d.value);
            })

            chart_0.selectAll(".carbon-bar")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration
              } else {
                return 0
              }
            })
            .attr("y", function (d) {
              return yScaleLeft(d.value);
            })
            .attr("height", function (d) {
              return yScaleLeft(0) - yScaleLeft(d.value);
            })

          /*
          Chart: 1

         CO-2 Emmissions

          */
          var chart_1 = d3
            .select(".chart-1")
            .append("svg")
            .attr("width", d3.select(".chart-1").style("width"))
            .attr("height", d3.select(".chart-1").style("height"));

          var chart_1_title_rect = chart_1
            .append("rect")
            .attr("class", "chart-title-rect")
            .attr("x", -5)
            .attr("y", 18)
            .attr("height", 34)
            .attr("fill", "#73B431");

          chart_1
            .append("text")
            .attr("class", "chart-title chart-1-title")
            .text("CO₂e Saved")
            .attr("x", 10)
            .attr("y", 41)
            .attr("fill", "#fff");

          chart_1_title_rect.attr(
            "width",
            document
              .getElementsByClassName("chart-1-title")[0]
              .getBoundingClientRect().width + 33
          );

          var max_Chart_1 = d3.max(newCo2Data, function (d) {
            return d.value;
          });

          xScale_Chart_1 = d3
            .scaleTime()
            .domain([currentMinDate, currentMaxDate])
            .range([
              margin.left,
              d3.select(".chart-1").style("width").slice(0, -2) - margin.right,
            ]);

          yScale_Chart_1 = d3
            .scaleLinear()
            .domain([0, max_Chart_1])
            .range([
              d3.select(".chart-1").style("height").slice(0, -2) -
                margin.bottom,
              margin.top,
            ])
            .nice();

          var line2 = d3
            .line()
            .x(function (d, i) {
              return xScale_Chart_1(new Date(d.date));
            })
            .y(function (d) {
              return yScale_Chart_1(d.value);
            })
            .defined(function (d) {
              return d.value !== null;
            })
            .curve(d3.curveMonotoneX);

            var line2_hide = d3
            .line()
            .x(function (d, i) {
              return xScale_Chart_1(new Date(d.date));
            })
            .y(function (d) {
              return yScale_Chart_1(0);
            })
            .defined(function (d) {
              return d.value !== null;
            })
            .curve(d3.curveMonotoneX);

          setTimeout(function () {
            var control_container_1 = d3
              .select(".chart-1")
              .append("div")
              .attr("class", "control-container");

            control_container_1
              .append("div")
              .attr("class", "compress-expand-container")
              .append("i")
              .attr("class", function () {
                if (expandStatus) {
                  return "fas fa-compress-arrows-alt fa-lg";
                } else {
                  return "fas fa-expand-arrows-alt fa-lg";
                }
              })
              .style("cursor", "pointer")
              .on("click", function () {
                if (expandStatus) {
                  contract_chart();
                } else {
                  expand_chart(1);
                }
              })
              .on("mouseover", function () {
                if (expandStatus) {
                  showGeneralTooltip("Contract Chart");
                } else {
                  showGeneralTooltip("Expand Chart");
                }
              })
              .on("mouseout", hideGeneralTooltip);

            chart_1
              .append("g")
              .attr("class", "y-axis")
              .call(d3.axisLeft(yScale_Chart_1))
              .attr("transform", "translate(" + margin.left + ",0)");

            if (days.length > 180) {
              chart_1
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3.axisBottom(xScale_Chart_1).tickFormat(d3.timeFormat("%b"))
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-1").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            } else {
              chart_1
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3
                    .axisBottom(xScale_Chart_1)
                    .tickFormat(d3.timeFormat("%m/%e"))
                    .tickArguments([ticks])
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-1").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            }

            chart_1
              .append("path")
              .datum(newCo2Data)
              .attr("class", "co2-line")
              .attr("d", line2_hide);

            chart_1
              .selectAll(".co2-circle")
              .data(newCo2Data)
              .enter()
              .append("circle")
              .attr("class", "co2-circle")
              .attr("cx", function (d, i) {
                return xScale_Chart_1(new Date(d.date));
              })
              .attr("cy", function (d) {
                return yScale_Chart_1(d.value);
              })
              .attr("r", 0);

            chart_1
              .append("rect")
              .attr("class", "mouseover-rect")
              .attr("opacity", 0)
              .attr("x", margin.left)
              .attr("y", margin.top)
              .attr(
                "width",
                d3.select(".chart-1").style("width").slice(0, -2) -
                  margin.left -
                  margin.right
              )
              .attr(
                "height",
                d3.select(".chart-1").style("height").slice(0, -2) -
                  margin.top -
                  margin.bottom
              )
              .on("mouseover", function () {
                graph_1_mouseover();
              })
              .on("mousemove", function () {
                graph_1_mouseover();
              })
              .on("mouseout", function () {
                hideChartTooltip();
              });

            var chart_1_legend = [
              { color: "#1c5630", label: "CO₂ Emission Saving (kg)" },
            ];

            chart_1_legend.forEach(function (u, i) {
              chart_1
                .append("rect")
                .attr("width", legend_size)
                .attr("height", legend_size)
                .attr("fill", u.color)
                .attr("y", 37)
                .attr("x", i * 120 + 170);

              chart_1
                .append("text")
                .attr("class", "legend-label")
                .attr("y", 48)
                .attr("x", i * 120 + 190)
                .text(u.label);
            });

            // transition in
            chart_1.selectAll(".co2-line")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration - 100
              } else {
                return 0
              }
            })
            .attr("d", line2);
          }, 100);

          


          /*
          Chart: 2

          Compost

          */

          var max_Chart_2 = d3.max(newCompostData, function (d) {
            return d.new_value;
          });

          var xScale_Chart_2 = d3
            .scaleTime()
            .domain([currentMinDate, currentMaxDate])
            .range([
              margin.left,
              d3.select(".chart-2").style("width").slice(0, -2) - margin.right,
            ]);

          yScale_Chart_2 = d3
            .scaleLinear()
            .domain([0, max_Chart_2])
            .range([
              d3.select(".chart-2").style("height").slice(0, -2) -
                margin.bottom,
              margin.top,
            ]);

          setTimeout(function () {
            var control_container_2 = d3
              .select(".chart-2")
              .append("div")
              .attr("class", "control-container");

            control_container_2
              .append("div")
              .attr("class", "compress-expand-container")
              .append("i")
              .attr("class", function () {
                if (expandStatus) {
                  return "fas fa-compress-arrows-alt fa-lg";
                } else {
                  return "fas fa-expand-arrows-alt fa-lg";
                }
              })
              .style("cursor", "pointer")
              .on("click", function () {
                if (expandStatus) {
                  contract_chart();
                } else {
                  expand_chart(2);
                }
              })
              .on("mouseover", function () {
                if (expandStatus) {
                  showGeneralTooltip("Contract Chart");
                } else {
                  showGeneralTooltip("Expand Chart");
                }
              })
              .on("mouseout", hideGeneralTooltip);

            var chart_2 = d3
              .select(".chart-2")
              .append("svg")
              .attr("width", d3.select(".chart-2").style("width"))
              .attr("height", d3.select(".chart-2").style("height"));

            var chart_2_title_rect = chart_2
              .append("rect")
              .attr("class", "chart-title-rect")
              .attr("x", -5)
              .attr("y", 18)
              .attr("height", 34)
              .attr("fill", "#73B431");

            chart_2
              .append("text")
              .attr("class", "chart-title chart-2-title")
              .text("Compost output")
              .attr("x", 10)
              .attr("y", 41)
              .attr("fill", "#fff");

            chart_2_title_rect.attr(
              "width",
              document
                .getElementsByClassName("chart-2-title")[0]
                .getBoundingClientRect().width + 33
            );

            chart_2
              .append("g")
              .attr("class", "y-axis")
              .call(d3.axisLeft(yScale_Chart_2))
              .attr("transform", "translate(" + margin.left + ",0)");

            if (days.length > 180) {
              chart_2
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3.axisBottom(xScale_Chart_2).tickFormat(d3.timeFormat("%b"))
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-2").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            } else {
              chart_2
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3
                    .axisBottom(xScale_Chart_2)
                    .tickFormat(d3.timeFormat("%m/%e"))
                    .tickArguments([ticks])
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-2").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            }

            chart_2
              .selectAll(".compost-bar")
              .data(newCompostData)
              .enter()
              .append("rect")
              .attr("class", "bar compost-bar")
              .attr("x", function (d, i) {
                return xScale_Chart_2(new Date(d.date));
              })
              .attr("y", function (d) {
                return yScale_Chart_2(0);
              })
              .attr("width", function (d, i) {
                var next = d3.utcDay.offset(d.date, 1);

                return (
                  xScale_Chart_2(new Date(next)) -
                  xScale_Chart_2(new Date(d.date))
                );
              })
              .attr("height", function (d) {
                return 0
              })
              .on("mouseover", function (d) {
                graph_2_mouseover(d);
              })
              .on("mouseout", hideChartTooltip);

            var chart_2_legend = [
              { color: "#73b431", label: "Compost Output (kg)" },
            ];

            chart_2_legend.forEach(function (u, i) {
              chart_2
                .append("rect")
                .attr("width", legend_size)
                .attr("height", legend_size)
                .attr("fill", u.color)
                .attr("y", 37)
                .attr("x", i * 120 + 170);

              chart_2
                .append("text")
                .attr("class", "legend-label")
                .attr("y", 48)
                .attr("x", i * 120 + 190)
                .text(u.label);
            });

            // transition in
            chart_2.selectAll(".compost-bar")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration - 100
              } else {
                return 0
              }
            })
            .attr("y", function (d) {
              return yScale_Chart_2(d.new_value);
            })
            .attr("height", function (d) {
              return yScale_Chart_2(0) - yScale_Chart_2(d.new_value);
            })
          }, 100);

          /*
          Chart: 3

          Airspace

          */
          var max_Chart_3 = d3.max(newAirspaceData, function (d) {
            return d.value;
          });

          var xScale_Chart_3 = d3
            .scaleTime()
            .domain([currentMinDate, currentMaxDate])
            .range([
              margin.left,
              d3.select(".chart-3").style("width").slice(0, -2) - margin.right,
            ]);

          yScale_Chart_3 = d3
            .scaleLinear()
            .domain([0, max_Chart_3])
            .range([
              d3.select(".chart-3").style("height").slice(0, -2) -
                margin.bottom,
              margin.top,
            ]);

          var area_Chart_3 = d3
            .area()
            .defined((d) => !isNaN(d.value))
            .x((d) => xScale_Chart_3(d.date))
            .y0(yScale_Chart_3(0))
            .y1((d) => yScale_Chart_3(d.value));

            var area_Chart_3_hide = d3
            .area()
            .defined((d) => !isNaN(d.value))
            .x((d) => xScale_Chart_3(d.date))
            .y0(yScale_Chart_3(0))
            .y1((d) => yScale_Chart_3(0));

          setTimeout(function () {
            var control_container_3 = d3
              .select(".chart-3")
              .append("div")
              .attr("class", "control-container");

            control_container_3
              .append("div")
              .attr("class", "compress-expand-container")
              .append("i")
              .attr("class", function () {
                if (expandStatus) {
                  return "fas fa-compress-arrows-alt fa-lg";
                } else {
                  return "fas fa-expand-arrows-alt fa-lg";
                }
              })
              .style("cursor", "pointer")
              .on("click", function () {
                if (expandStatus) {
                  contract_chart();
                } else {
                  expand_chart(3);
                }
              })
              .on("mouseover", function () {
                if (expandStatus) {
                  showGeneralTooltip("Contract Chart");
                } else {
                  showGeneralTooltip("Expand Chart");
                }
              })
              .on("mouseout", hideGeneralTooltip);

            var chart_3 = d3
              .select(".chart-3")
              .append("svg")
              .attr("width", d3.select(".chart-3").style("width"))
              .attr("height", d3.select(".chart-3").style("height"));

            var chart_3_title_rect = chart_3
              .append("rect")
              .attr("class", "chart-title-rect")
              .attr("x", -5)
              .attr("y", 18)
              .attr("height", 34)
              .attr("fill", "#73B431");

            chart_3
              .append("text")
              .attr("class", "chart-title chart-3-title")
              .text("Airspace Saved")
              .attr("x", 10)
              .attr("y", 41)
              .attr("fill", "#fff");

            chart_3_title_rect.attr(
              "width",
              document
                .getElementsByClassName("chart-3-title")[0]
                .getBoundingClientRect().width + 33
            );

            chart_3
              .append("g")
              .attr("class", "y-axis")
              .call(d3.axisLeft(yScale_Chart_3))
              .attr("transform", "translate(" + margin.left + ",0)");

            if (days.length > 180) {
              chart_3
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3.axisBottom(xScale_Chart_3).tickFormat(d3.timeFormat("%b"))
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-3").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            } else {
              chart_3
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3
                    .axisBottom(xScale_Chart_3)
                    .tickFormat(d3.timeFormat("%m/%e"))
                    .tickArguments([ticks])
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-3").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            }

            chart_3
              .append("path")
              .datum(newAirspaceData)
              .attr("class", "airspace-area")
              .attr("d", area_Chart_3_hide);

            chart_3
              .selectAll(".airspace-circle")
              .data(newAirspaceData)
              .enter()
              .append("circle")
              .attr("class", "airspace-circle")
              .attr("cx", function (d, i) {
                return xScale_Chart_3(new Date(d.date));
              })
              .attr("cy", function (d) {
                return yScale_Chart_3(0);
              })
              .attr("r", 0);

            chart_3
              .append("rect")
              .attr("class", "mouseover-rect")
              .attr("opacity", 0)
              .attr("x", margin.left)
              .attr("y", margin.top)
              .attr(
                "width",
                d3.select(".chart-3").style("width").slice(0, -2) -
                  margin.left -
                  margin.right
              )
              .attr(
                "height",
                d3.select(".chart-3").style("height").slice(0, -2) -
                  margin.top -
                  margin.bottom
              )
              .on("mouseover", function () {
                graph_3_mouseover();
              })
              .on("mousemove", function () {
                graph_3_mouseover();
              })
              .on("mouseout", function () {
                hideChartTooltip();
              });

            var chart_3_legend = [{ color: "#2274A5", label: "Airspace (m²)" }];

            chart_3_legend.forEach(function (u, i) {
              chart_3
                .append("rect")
                .attr("width", legend_size)
                .attr("height", legend_size)
                .attr("fill", u.color)
                .attr("y", 37)
                .attr("x", i * 120 + 170);

              chart_3
                .append("text")
                .attr("class", "legend-label")
                .attr("y", 48)
                .attr("x", i * 120 + 190)
                .text(u.label);
            });

            // transition in
            chart_3.selectAll(".airspace-area")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration - 100
              } else {
                return 0
              }
            })
            .attr("d", area_Chart_3);

            chart_3.selectAll(".airspace-circle")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration - 100
              } else {
                return 0
              }
            })
            .attr("cy", function (d) {
              return yScale_Chart_3(d.value);
            })

          }, 100);

          /*
          Chart: 4

          Temperature

          */
          var max_Chart_4 = d3.max(newTempData, function (d) {
            return d.maxValue;
          });

          var xScale_Chart_4 = d3
            .scaleTime()
            .domain([currentMinDate, currentMaxDate])
            .range([
              margin.left,
              d3.select(".chart-4").style("width").slice(0, -2) - margin.right,
            ]);

          yScale_Chart_4 = d3
            .scaleLinear()
            .domain([0, max_Chart_4])
            .range([
              d3.select(".chart-4").style("height").slice(0, -2) -
                margin.bottom,
              margin.top,
            ])
            .nice();

          setTimeout(function () {
            var control_container_4 = d3
              .select(".chart-4")
              .append("div")
              .attr("class", "control-container");

            control_container_4
              .append("div")
              .attr("class", "compress-expand-container")
              .append("i")
              .attr("class", function () {
                if (expandStatus) {
                  return "fas fa-compress-arrows-alt fa-lg";
                } else {
                  return "fas fa-expand-arrows-alt fa-lg";
                }
              })
              .style("cursor", "pointer")
              .on("click", function () {
                if (expandStatus) {
                  contract_chart();
                } else {
                  expand_chart(4);
                }
              })
              .on("mouseover", function () {
                if (expandStatus) {
                  showGeneralTooltip("Contract Chart");
                } else {
                  showGeneralTooltip("Expand Chart");
                }
              })
              .on("mouseout", hideGeneralTooltip);

            var chart_4 = d3
              .select(".chart-4")
              .append("svg")
              .attr("width", d3.select(".chart-4").style("width"))
              .attr("height", d3.select(".chart-4").style("height"));

            var chart_4_title_rect = chart_4
              .append("rect")
              .attr("class", "chart-title-rect")
              .attr("x", -5)
              .attr("y", 18)
              .attr("height", 34)
              .attr("fill", "#73B431");

            chart_4
              .append("text")
              .attr("class", "chart-title chart-4-title")
              .text("Temperature")
              .attr("x", 10)
              .attr("y", 41)
              .attr("fill", "#fff");

            chart_4_title_rect.attr(
              "width",
              document
                .getElementsByClassName("chart-4-title")[0]
                .getBoundingClientRect().width + 33
            );

            chart_4
              .append("g")
              .attr("class", "y-axis")
              .call(d3.axisLeft(yScale_Chart_4))
              .attr("transform", "translate(" + margin.left + ",0)");

            if (days.length > 180) {
              chart_4
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3.axisBottom(xScale_Chart_4).tickFormat(d3.timeFormat("%b"))
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-4").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            } else {
              chart_4
                .append("g")
                .attr("class", "x-axis")
                .call(
                  d3
                    .axisBottom(xScale_Chart_4)
                    .tickFormat(d3.timeFormat("%m/%e"))
                    .tickArguments([ticks])
                )
                .attr(
                  "transform",
                  "translate(0," +
                    (d3.select(".chart-4").style("height").slice(0, -2) -
                      margin.bottom) +
                    ")"
                );
            }

            chart_4
              .append("line")
              .attr("class", "temp-line")
              .attr("x1", xScale_Chart_4(new Date(minDate)))
              .attr("x2", xScale_Chart_4(new Date(maxDate)))
              .attr("y1", yScale_Chart_4(50))
              .attr("y2", yScale_Chart_4(50))


            chart_4
              .selectAll(".temp-bar")
              .data(newTempData)
              .enter()
              .append("rect")
              .attr("class", "bar temp-bar")
              .attr("x", function (d, i) {
                return xScale_Chart_4(new Date(d.date));
              })
              .attr("y", function (d) {
                return yScale_Chart_4(0);
              })
              .attr("width", function (d, i) {
                var next = d3.utcDay.offset(d.date, 1);

                return (
                  xScale_Chart_4(new Date(next)) -
                  xScale_Chart_4(new Date(d.date))
                );
              })
              .attr("height", function (d) {
                return 0
              })
              .on("mouseover", function (d) {
                graph_4_mouseover(d);
              })
              .on("mouseout", hideChartTooltip);


            var chart_4_legend = [
              { color: "#ff8000", label: "Temperature Range (C)" },
            ]; //8F250C

            chart_4_legend.forEach(function (u, i) {
              chart_4
                .append("rect")
                .attr("width", legend_size)
                .attr("height", legend_size)
                .attr("fill", u.color)
                .attr("y", 37)
                .attr("x", i * 120 + 170);

              chart_4
                .append("text")
                .attr("class", "legend-label")
                .attr("y", 48)
                .attr("x", i * 120 + 190)
                .text(u.label);
            });

            // transition in
            chart_4.selectAll(".temp-bar")
            .transition()
            .duration(function() {
              if (animation == 1) {
                return hide_duration - 100
              } else {
                return 0
              }
            })
            .attr("y", function (d) {
              return yScale_Chart_4(d.maxValue);
            })
            .attr("height", function (d) {
              return yScale_Chart_4(d.minValue) - yScale_Chart_4(d.maxValue);
            })
          }, 100);

          /*
          Date Selection

          Slider to select date shown

          */
          if (
            document
              .getElementsByClassName("slide-container")[0]
              .getElementsByTagName("svg").length == 0
          ) {
            const dateSliderMin = margin.left;

            const dateSliderMax =
              d3.select(".slide-container").style("width").slice(0, -2) -
              margin.right - 120;

            update_date(0, currentMinDate);
            update_date(1, currentMaxDate);

            var dateXScale = d3
              .scaleTime()
              .domain([minDate, maxDate])
              .range([dateSliderMin, dateSliderMax])
              .clamp(true);

            var chart_date = d3
              .select(".slide-container")
              .append("svg")
              .attr("width", d3.select(".slide-container").style("width"))
              .attr("height", d3.select(".slide-container").style("height"));

            chart_date
              .append("g")
              .attr("class", "x-axis")
              .call(d3.axisBottom(dateXScale).tickFormat(d3.timeFormat("%b")))
              .attr(
                "transform",
                "translate(0," +
                  (d3.select(".slide-container").style("height").slice(0, -2) -
                    28) +
                  ")"
              );

            chart_date.select(".domain").style("display", "none");

            function dragMoveDate(d, handleID) {
              clearTimeout(dateVar);
              // Get the updated X location computed by the drag behavior.
              var x = d3.event.x;

              // Constrain x to be between x1 and x2 (the ends of the line).
              x =
                x < dateSliderMin
                  ? dateSliderMin
                  : x > dateSliderMax
                  ? dateSliderMax
                  : x;

              var dateRounded = roundDate(dateXScale.invert(x));

              // This assignment is necessary for multiple drag gestures.
              // It makes the drag.origin function yield the correct value.

              // Update the handle location.
              if (handleID === 0) {
                dateSliderHandle0.attr("cx", dateXScale(dateRounded));
                update_date(0, dateRounded);
                currentMinDate = dateRounded;
                dateSliderLineSelected.attr("x1", dateXScale(dateRounded));
              } else {
                dateSliderHandle1.attr("cx", dateXScale(dateRounded));
                update_date(1, dateRounded);
                currentMaxDate = dateRounded;
                dateSliderLineSelected.attr("x2", dateXScale(dateRounded));
              }
              //timeout
              //graphs need to start at current
              dateVar = setTimeout(function () {
                //hide_charts();
                remove_graphs();
                render_graphs();
              }, 2000);
            }

            var dragDate0 = d3.drag().on("drag", function (d) {
              dragMoveDate(d, 0);
            });

            var dragDate1 = d3.drag().on("drag", function (d) {
              dragMoveDate(d, 1);
            });

            dateLabel = d3.timeFormat("%e %b");

            var dateSliderLine = chart_date
              .append("line")
              .attr("class", "date-slider")
              .attr("x1", dateSliderMin)
              .attr("x2", dateSliderMax)
              .attr("y1", 12)
              .attr("y2", 12)
              .style("stroke", "#CCCCCC")
              .style("stroke-width", 6)
              .style("cursor", "pointer");

            var dateSliderLineSelected = chart_date
              .append("line")
              .attr("class", "date-slider-selected")
              .attr("x1", dateXScale(currentMinDate))
              .attr("x2", dateXScale(currentMaxDate))
              .attr("y1", 13)
              .attr("y2", 13)
              .style("stroke", "#1C5630")
              .style("stroke-width", 8)
              .style("cursor", "pointer");

            /*var dateSliderHandleLabel0 = chart_date
              .append("text")
              .attr("class", "date-slider-handle-label")
              .attr("id", "date-slider-handle-label-0")
              .attr("y", 22)
              .attr("x", dateXScale(currentMinDate) + 7)
              .text(dateLabel(currentMinDate));*/

            var dateSliderHandle0 = chart_date
              .append("circle")
              .attr("class", "date-slider-handle")
              .attr("id", "date-slider-handle-0")
              .attr("r", 10)
              .attr("cy", 12)
              .attr("cx", dateXScale(currentMinDate))
              .style("cursor", "pointer")
              .style("stroke", "#1C5630")
              .style("stroke-width", 3)
              .attr("fill", "#fff")
              .call(dragDate0);

            /*var dateSliderHandleLabel1 = chart_date
              .append("text")
              .attr("class", "date-slider-handle-label")
              .attr("id", "date-slider-handle-label-1")
              .attr("y", 22)
              .attr("x", dateXScale(currentMaxDate) + 7)
              .text(dateLabel(currentMaxDate));*/

            var dateSliderHandle1 = chart_date
              .append("circle")
              .attr("class", "date-slider-handle")
              .attr("id", "date-slider-handle-1")
              .attr("r", 10)
              .attr("cy", 12)
              .attr("cx", dateXScale(currentMaxDate))
              .style("cursor", "pointer")
              .style("stroke", "#1C5630")
              .style("stroke-width", 3)
              .attr("fill", "#fff")
              .call(dragDate1);
          }

          function expand_chart(chart_id) {
            hideGeneralTooltip();
            expandStatus = true;

            d3.select(".header").node().style.display = "none";

            for (let i = 0; i < numGraphs; i++) {
              if (i !== chart_id) {
                d3
                  .select(".chart-" + i)
                  .node().parentNode.parentNode.style.display = "none";
              }
            }
            var width = window.innerWidth - 90;
            var height = window.innerHeight - 30;

            d3
              .select(".chart-" + chart_id)
              .node().parentNode.style.width = width;
            d3.select(".chart-" + chart_id).style("width", width + "px");
            d3
              .select(".chart-" + chart_id)
              .node().parentNode.style.height = height;
            d3.select(".chart-" + chart_id).style("height", height + "px");

            d3.select(".chart-" + chart_id)
              .select(".expand-container")
              .style("display", "none");
            d3.select(".chart-" + chart_id)
              .select(".compress-container")
              .style("display", "block");
            remove_graphs();
            render_graphs();
          }

          function contract_chart() {
            hideGeneralTooltip();
            expandStatus = false;
            d3.select(".header").node().style.display = "block";
            for (let i = 0; i < numGraphs; i++) {
              d3
                .select(".chart-" + i)
                .node().parentNode.parentNode.style.display = "block";
              d3
                .select(".chart-" + i)
                .node().parentNode.parentNode.style.height =
                chartDims[i].height;
              d3.select(".chart-" + i).node().parentNode.style.height =
                chartDims[i].height;
              d3.select(".chart-" + i).style(
                "height",
                chartDims[i].height + "px"
              );
            }

            remove_graphs();
            render_graphs();
          }

          // end function
        }

        function resize_header() {
          
        }
      }

      /*function hide_charts() {
        d3.selectAll(".carbon-bar")
          .transition()
          .duration(hide_duration)
          .attr("y", function (d) {
            return yScaleLeft(0);
          })
          .attr("height", function (d) {
            return 0;
          });

        d3.selectAll(".waste-bar")
          .transition()
          .duration(hide_duration)
          .attr("y", function (d) {
            return yScaleLeft(0);
          })
          .attr("height", function (d) {
            return 0;
          });

        d3.selectAll(".weight-line")
          .transition()
          .duration(hide_duration)
          .attr("d", line1_hide);
      }*/

      function graph_4_mouseover(data) {
        var date = data.date;
        var min, max;
        d3.selectAll(".temp-bar").style("stroke-width", function (d) {
          if (d.date == data.date) {
            max = d.maxValue;
            min = d.minValue;
            ave = (d.avgValue)
            return 2;
          } else {
            return 0;
          }
        });
        var mouseover_text = [
          { label: "Date", value: formatDateObject(date) },
          { label: "Max Temp", value: max },
          { label: "Min Temp", value: min },
          { label: "Average Temp", value: ave.toFixed(1)}
        ];
        showChartTooltip(mouseover_text);
      }

      function graph_3_mouseover() {
        var x = d3.event.offsetX;
        var airspace;

        var date_inv = xScale_Chart_1.invert(x);
        date = date_inv.getMonth() * 100 + date_inv.getDate();
        d3.selectAll(".airspace-circle")
          .style("stroke-width", function (d, i) {
            var dated = d.date.getMonth() * 100 + d.date.getDate();
            if (dated == date) {
              airspace = d.value;
              return 2;
            } else {
              return 0;
            }
          })
          .attr("r", function (d) {
            var dated = d.date.getMonth() * 100 + d.date.getDate();
            if (d.value != null && dated == date) {
              return 2;
            } else {
              return 0;
            }
          });
        var mouseover_text = [
          { label: "Date", value: formatDateObject(date_inv) },
          { label: "Airspace", value: airspace.toFixed(1) },
        ];
        showChartTooltip(mouseover_text);
      }

      function graph_2_mouseover(data) {
        var date = data.date;
        var compost;
        d3.selectAll(".compost-bar").style("stroke-width", function (d) {
          if (d.date == data.date) {
            compost = d.new_value;
            return 2;
          } else {
            return 0;
          }
        });
        var mouseover_text = [
          { label: "Date", value: formatDateObject(date) },
          { label: "Compost", value: compost.toFixed(1) },
        ];
        showChartTooltip(mouseover_text);
      }

      function graph_1_mouseover() {
        var x = d3.event.offsetX;
        var co2;

        var date_inv = xScale_Chart_1.invert(x);
        date = date_inv.getMonth() * 100 + date_inv.getDate();
        d3.selectAll(".co2-circle")
          .style("stroke-width", function (d, i) {
            var dated = d.date.getMonth() * 100 + d.date.getDate();
            if (dated == date) {
              co2 = d.value;
              return 2;
            } else {
              return 0;
            }
          })
          .attr("r", function (d) {
            var dated = d.date.getMonth() * 100 + d.date.getDate();
            if (d.value != null && dated == date) {
              return 2;
            } else {
              return 0;
            }
          });
        var mouseover_text = [
          { label: "Date", value: formatDateObject(date_inv) },
          { label: "CO2", value: co2.toFixed(1) },
        ];
        showChartTooltip(mouseover_text);
      }

      function graph_0_mouseover(data) {
        var date = data.date;
        var weight, carbon, waste;
        d3.selectAll(".weight-circle")
          .style("stroke-width", function (d) {
            if (d.date == data.date) {
              weight = d.value;
              return 2;
            } else {
              return 0;
            }
          })
          .attr("r", function (d) {
            if (d.value != null && d.date == data.date) {
              return 2;
            } else {
              return 0;
            }
          });
        d3.selectAll(".carbon-bar").style("stroke-width", function (d) {
          if (d.date == data.date) {
            carbon = d.value;
            return 2;
          } else {
            return 0;
          }
        });
        d3.selectAll(".waste-bar").style("stroke-width", function (d) {
          if (d.date == data.date) {
            waste = d.value;
            return 2;
          } else {
            return 0;
          }
        });
        var mouseover_text = [
          { label: "Date", value: formatDateObject(date) },
          { label: "Weight", value: weight.toFixed(1) },
          { label: "Carbon", value: carbon.toFixed(1) },
          { label: "Waste", value: waste.toFixed(1) },
        ];
        showChartTooltip(mouseover_text);
      }

      function showChartTooltip(text) {
        d3.select(".chart-tooltip").style("display", "block");
        var content = "";
        text.forEach(function (v) {
          content +=
            "<div class='tooltip-row'><div class='tooltip-label'>" +
            v.label +
            "</div><div class='tooltip-value'>" +
            v.value +
            "</div></div>";
        });
        d3.select(".chart-tooltip-content").html(content);

        var x =
          d3.event.x -
          d3.select(".chart-tooltip-content").node().clientWidth -
          30;
        if (x < 0) {
          x = d3.event.x + 20;
        }
        var y = d3.event.y;
        d3.select(".chart-tooltip")
          .style("top", y + "px")
          .style("left", x + "px");
      }

      function hideChartTooltip() {
        d3.select(".chart-tooltip").style("display", "none");
        d3.selectAll(".weight-circle").style("stroke-width", 0).attr("r", 0);
        d3.selectAll(".airspace-circle").style("stroke-width", 0).attr("r", 0);
        d3.selectAll(".co2-circle").style("stroke-width", 0).attr("r", 0);
        d3.selectAll(".carbon-bar").style("stroke-width", 0);
        d3.selectAll(".waste-bar").style("stroke-width", 0);
        d3.selectAll(".compost-bar").style("stroke-width", 0);
        d3.selectAll(".temp-bar").style("stroke-width", 0);
      }

      function update_date(slot, date) {
        var prev_date = d3
          .select(".date-selection-label")
          .node()
          .textContent.replace(/\n/g, "");
        var start_date = prev_date.split(" - ")[0];
        var end_date = prev_date.split(" - ")[1];
        
        if (slot === 0) {
          start_date = formatDateObject(date);
        } else {
          end_date = formatDateObject(date);
        }
        d3.select(".date-selection-label").html(
          "<i class='far fa-calendar-alt calendar-icon'></i>" +
            start_date +
            " - " +
            end_date
        );
      }

      function format_value(value) {
        return value
          .toFixed(0)
          .toString()
          .replace(/\B(?=(\d{3})+(?!\d))/g, " ");
      }

      function roundDate(date) {
        if (date.getHours() > 11) {
          date.setDate(date.getDate() + 1);
          date.setHours(0, 0, 0, 0);
        } else {
          date.setHours(0, 0, 0, 0);
        }

        return date;
      }

      function showGeneralTooltip(content) {
        d3.select(".general-tooltip").style("display", "block");
        d3.select(".general-tooltip-content").html(content);

        var x =
          d3.event.x -
          d3.select(".general-tooltip-content").node().clientWidth -
          30;
        if (x < 0) {
          x = d3.event.x + 20;
        }
        var y = d3.event.y;
        d3.select(".general-tooltip")
          .style("top", y + "px")
          .style("left", x + "px");
      }

      function hideGeneralTooltip() {
        d3.select(".general-tooltip").style("display", "none");
      }

      function remove_graphs() {
          document.getElementsByClassName("slide-container")[0].innerHTML = ""
        for (let i = 0; i < numGraphs; i++) {
          document.getElementsByClassName("chart-" + i)[0].innerHTML = "";
        }
      }
    </script>
  </body>
</html>
